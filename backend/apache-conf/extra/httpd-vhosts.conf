# Virtual Hosts and Proxy Configuration

# Enable required modules
<IfModule !proxy_module>
    LoadModule proxy_module modules/mod_proxy.so
</IfModule>
<IfModule !proxy_http_module>
    LoadModule proxy_http_module modules/mod_proxy_http.so
</IfModule>
<IfModule !rewrite_module>
    LoadModule rewrite_module modules/mod_rewrite.so
</IfModule>
<IfModule !headers_module>
    LoadModule headers_module modules/mod_headers.so
</IfModule>

# Custom Server Configuration
ServerAdmin webmaster@localhost
DocumentRoot "/usr/local/apache2/htdocs"

# Proxy configuration for API
ProxyPass /api http://backend:8090
ProxyPassReverse /api http://backend:8090

# CORS Headers
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS, DELETE, PUT"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"

# Handle CORS preflight requests
<If "%{REQUEST_METHOD} == 'OPTIONS'">
    Header always set Access-Control-Max-Age "1728000"
    Header always set Content-Type "text/plain charset=UTF-8"
    Header always set Content-Length "0"
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
    Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
    Require all granted
    RewriteEngine On
    RewriteRule .* - [R=200,L]
</If>
